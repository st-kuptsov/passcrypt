# PassCrypt

PassCrypt - это библиотека для безопасного шифрования и дешифрования паролей с использованием гибридного подхода RSA-OAEP/AES-GCM и секретного разделения ключей.

## Особенности

- **Гибридное шифрование**: Использует RSA-OAEP для шифрования AES-ключа и AES-GCM для шифрования данных
- **Секретное разделение ключей**: Приватный ключ разделяется на 50 фрагментов (16 масок, 34 части ключа, 10 dummy)
- **Дополнительная защита**: XOR-маскирование приватного ключа перед разделением
- **Безопасная деривация**: Использование Argon2id для генерации ключей фрагментов
- **Обфускация кода**: Поддержка обфускации с помощью garble для дополнительной защиты

## Установка

```bash
go get github.com/yourusername/passcrypt
```

## Использование

### Генерация ключей

Перед использованием библиотеки необходимо сгенерировать ключи:

```bash
go run cmd/passcrypt/main.go init /path/to/output
```

### Шифрование пароля

```go
package main

import (
    "fmt"
    "log"
    
    "github.com/yourusername/passcrypt"
)

func main() {
    password := "mysecretpassword"
    
    encrypted, err := passcrypt.Encrypt(password)
    if err != nil {
        log.Fatal(err)
    }
    
    fmt.Printf("Encrypted: %s\n", encrypted)
}
```

### Дешифрование пароля

```go
package main

import (
    "fmt"
    "log"
    
    "github.com/yourusername/passcrypt"
)

func main() {
    encrypted := "encrypted_password_string"
    
    decrypted, err := passcrypt.Decrypt(encrypted)
    if err != nil {
        log.Fatal(err)
    }
    
    fmt.Printf("Decrypted: %s\n", decrypted)
}
```

## Архитектура безопасности

### Механизм шифрования

1. **Гибридное шифрование**:
   - Генерируется случайный 256-битный AES-ключ
   - Пароль шифруется с помощью AES-GCM
   - AES-ключ шифруется с помощью публичного RSA-ключа (RSA-OAEP)

2. **Секретное разделение ключей**:
   - Приватный RSA-ключ XOR-маскируется с 512-байтной случайной маской
   - Результат разделения: 50 фрагментов (16 масок, 34 части ключа, 10 dummy)
   - Порядок фрагментов случайный

3. **Механизм fragmentPasswordSeed**:
   - При генерации фрагментов создается секретный seed (fragmentPasswordSeed)
   - Для каждого фрагмента вычисляется уникальный пароль на основе:
     - fragmentPasswordSeed (секретный seed)
     - deriveSalt (соль для деривации)
     - magicConstants (магические константы)
     - индекс фрагмента
   - Пароль фрагмента используется для генерации 32-байтного ключа с помощью Argon2id
   - Каждый фрагмент шифруется с использованием своего уникального ключа

4. **Шифрование фрагментов**:
   - Каждый фрагмент шифруется с помощью AES-GCM
   - Уникальный ключ для каждого фрагмента генерируется с помощью Argon2id
   - Данные и nonce фрагмента кодируются в Base64

### Безопасность ключей

- Приватный ключ никогда не хранится в открытом виде
- Все фрагменты зашифрованы с уникальными ключами
- Для восстановления ключа необходимы все 40 реальных фрагментов (16 масок + 34 части)
- Dummy фрагменты не влияют на восстановление ключа
- Порядок фрагментов важен для корректного восстановления

## Команды CLI

### Генерация библиотеки

```bash
# Полная генерация с новыми ключами
go run cmd/passcrypt/main.go init /path/to/output

# Обновление только кода (сохранение существующих ключей)
go run cmd/passcrypt/main.go update /path/to/output

# Перегенерация ключей (сохранение существующего кода)
go run cmd/passcrypt/main.go rekey /path/to/output
```

### Обфускация

```bash
# Обфускация с помощью garble
go run cmd/passcrypt/main.go obfuscate /path/to/output
```

## Безопасность

### Рекомендации по использованию

1. **Хранение ключей**:
   - Храните сгенерированные файлы в безопасном месте
   - Не коммитьте файлы с ключами в репозиторий
   - Установите соответствующие права доступа к файлам (0600)

2. **Обфускация**:
   - Используйте команду `obfuscate` для обфускации кода перед сборкой
   - Обфускация затрудняет анализ алгоритмов шифрования

3. **Аудит**:
   - Регулярно проверяйте целостность сгенерированных файлов
   - Используйте контрольные суммы для проверки целостности

### Уязвимости

- Убедитесь, что ваша система защищена от атак по времени
- Используйте безопасные генераторы случайных чисел
- Регулярно обновляйте зависимости

## Лицензия

MIT
